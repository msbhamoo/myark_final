module.exports=[11695,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(46271),e=a.i(87532),f=a.i(60246),g=a.i(63519),h=a.i(41710),i=a.i(3314),j=a.i(70106);let k=(0,j.default)("ShieldOff",[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]]);var l=a.i(81402),m=a.i(20005),n=a.i(40737),o=a.i(96221),p=a.i(77156),q=a.i(41675);let r=(0,j.default)("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),s=(0,j.default)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var t=a.i(69520),u=a.i(1027),v=a.i(24669),w=a.i(99570),x=a.i(66718),y=a.i(86304),z=a.i(6015),A=a.i(35732),B=a.i(14574),C=a.i(57061),D=a.i(29246),E=a.i(70430),F=a.i(58682),G=a.i(68114),H=a.i(54614);a.s(["default",0,()=>{let[a,j]=(0,c.useState)([]),[I,J]=(0,c.useState)(!0),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)(!1),[S,T]=(0,c.useState)(!1),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(""),[Y,Z]=(0,c.useState)(""),[$,_]=(0,c.useState)(!1),{toast:aa}=(0,H.useToast)(),ab=async()=>{J(!0);try{let a=await F.studentAuthService.getAllUsers({search:K});j(a)}catch(a){console.error("Error fetching users:",a),aa({title:"Error",description:"Failed to load users",variant:"destructive"})}finally{J(!1)}};(0,c.useEffect)(()=>{ab()},[]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{ab()},300);return()=>clearTimeout(a)},[K]);let ac=async a=>{N(a),R(!0);try{let b=await F.studentAuthService.getUserSessions(a.id);P(b)}catch(a){console.error("Error fetching sessions:",a)}},ad=async()=>{if(M){_(!0);try{await F.studentAuthService.blockUser(M.id,W),aa({title:"User Blocked",description:`${M.phone} has been blocked`}),T(!1),X(""),ab()}catch(a){aa({title:"Error",description:"Failed to block user",variant:"destructive"})}finally{_(!1)}}},ae=async a=>{_(!0);try{await F.studentAuthService.unblockUser(a.id),aa({title:"User Unblocked",description:`${a.phone} has been unblocked`}),ab()}catch(a){aa({title:"Error",description:"Failed to unblock user",variant:"destructive"})}finally{_(!1)}},af=async()=>{if(M&&4===Y.length){_(!0);try{await F.studentAuthService.resetUserPin(M.id,Y),aa({title:"PIN Reset",description:`New PIN set for ${M.phone}`}),V(!1),Z("")}catch(a){aa({title:"Error",description:"Failed to reset PIN",variant:"destructive"})}finally{_(!1)}}},ag=async a=>{_(!0);try{if(await F.studentAuthService.terminateAllUserSessions(a.id),aa({title:"Sessions Terminated",description:"All sessions for this user have been ended"}),M?.id===a.id){let b=await F.studentAuthService.getUserSessions(a.id);P(b)}}catch(a){aa({title:"Error",description:"Failed to terminate sessions",variant:"destructive"})}finally{_(!1)}},ah=a=>{if(!a)return"Never";let b=new Date().getTime()-a.getTime(),c=Math.floor(b/6e4),d=Math.floor(b/36e5),e=Math.floor(b/864e5);return c<1?"Just now":c<60?`${c}m ago`:d<24?`${d}h ago`:e<7?`${e}d ago`:a.toLocaleDateString()},ai=a=>{if(a.isBlocked)return(0,b.jsxs)(y.Badge,{variant:"destructive",className:"gap-1",children:[(0,b.jsx)(k,{className:"w-3 h-3"})," Blocked"]});let c=a.lastLoginAt;if(!c)return(0,b.jsx)(y.Badge,{variant:"secondary",className:"gap-1",children:"New"});let d=(Date.now()-c.getTime())/36e5;return d<1?(0,b.jsxs)(y.Badge,{className:"gap-1 bg-success/20 text-success border-success/30",children:[(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-success animate-pulse"})," Online"]}):d<24?(0,b.jsx)(y.Badge,{variant:"secondary",className:"gap-1",children:"Active today"}):(0,b.jsx)(y.Badge,{variant:"outline",className:"gap-1 text-muted-foreground",children:"Away"})},aj={total:a.length,active:a.filter(a=>{let b=a.lastLoginAt;return b&&Date.now()-b.getTime()<864e5}).length,blocked:a.filter(a=>a.isBlocked).length};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-display font-bold",children:"Student Users"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage student accounts, sessions, and access"})]}),(0,b.jsxs)(w.Button,{variant:"outline",onClick:ab,disabled:I,children:[(0,b.jsx)(t.RefreshCw,{className:(0,G.cn)("w-4 h-4 mr-2",I&&"animate-spin")}),"Refresh"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"glass-card p-4 rounded-xl",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-primary/10",children:(0,b.jsx)(f.Users,{className:"w-5 h-5 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold",children:aj.total}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total Users"})]})]})}),(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"glass-card p-4 rounded-xl",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-success/10",children:(0,b.jsx)(u.Zap,{className:"w-5 h-5 text-success"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold",children:aj.active}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Active Today"})]})]})}),(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"glass-card p-4 rounded-xl",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-destructive/10",children:(0,b.jsx)(k,{className:"w-5 h-5 text-destructive"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold",children:aj.blocked}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Blocked"})]})]})})]}),(0,b.jsxs)("div",{className:"relative max-w-md",children:[(0,b.jsx)(e.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(x.Input,{placeholder:"Search by phone or name...",value:K,onChange:a=>L(a.target.value),className:"pl-10"})]}),(0,b.jsx)("div",{className:"glass-card rounded-xl overflow-hidden",children:(0,b.jsxs)(z.Table,{children:[(0,b.jsx)(z.TableHeader,{children:(0,b.jsxs)(z.TableRow,{children:[(0,b.jsx)(z.TableHead,{children:"User"}),(0,b.jsx)(z.TableHead,{children:"Phone"}),(0,b.jsx)(z.TableHead,{children:"XP / Level"}),(0,b.jsx)(z.TableHead,{children:"Last Login"}),(0,b.jsx)(z.TableHead,{children:"Status"}),(0,b.jsx)(z.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(z.TableBody,{children:I?(0,b.jsx)(z.TableRow,{children:(0,b.jsx)(z.TableCell,{colSpan:6,className:"text-center py-8",children:(0,b.jsx)(o.Loader2,{className:"w-6 h-6 animate-spin mx-auto text-muted-foreground"})})}):0===a.length?(0,b.jsx)(z.TableRow,{children:(0,b.jsx)(z.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):a.map(a=>(0,b.jsxs)(z.TableRow,{className:"group",children:[(0,b.jsx)(z.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-sm font-bold text-primary-foreground",children:a.name?.[0]?.toUpperCase()||"?"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.name||"Unnamed"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.grade?`Class ${a.grade}`:"Grade not set"})]})]})}),(0,b.jsx)(z.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Phone,{className:"w-4 h-4 text-muted-foreground"}),(0,b.jsxs)("span",{className:"font-mono",children:["+91 ",a.phone]})]})}),(0,b.jsx)(z.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(u.Zap,{className:"w-4 h-4 text-primary"}),(0,b.jsx)("span",{className:"font-medium",children:a.xpPoints}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:["/ Lvl ",a.level]})]})}),(0,b.jsx)(z.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(h.Clock,{className:"w-4 h-4 text-muted-foreground"}),ah(a.lastLoginAt)]})}),(0,b.jsx)(z.TableCell,{children:ai(a)}),(0,b.jsx)(z.TableCell,{className:"text-right",children:(0,b.jsxs)(A.DropdownMenu,{children:[(0,b.jsx)(A.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(w.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(n.MoreHorizontal,{className:"w-4 h-4"})})}),(0,b.jsxs)(A.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(A.DropdownMenuItem,{onClick:()=>ac(a),children:[(0,b.jsx)(p.Eye,{className:"w-4 h-4 mr-2"}),"View Details"]}),(0,b.jsxs)(A.DropdownMenuItem,{onClick:()=>{N(a),V(!0)},children:[(0,b.jsx)(l.Key,{className:"w-4 h-4 mr-2"}),"Reset PIN"]}),(0,b.jsxs)(A.DropdownMenuItem,{onClick:()=>ag(a),children:[(0,b.jsx)(m.LogOut,{className:"w-4 h-4 mr-2"}),"End All Sessions"]}),(0,b.jsx)(A.DropdownMenuSeparator,{}),a.isBlocked?(0,b.jsxs)(A.DropdownMenuItem,{onClick:()=>ae(a),children:[(0,b.jsx)(i.Shield,{className:"w-4 h-4 mr-2"}),"Unblock User"]}):(0,b.jsxs)(A.DropdownMenuItem,{className:"text-destructive",onClick:()=>{N(a),T(!0)},children:[(0,b.jsx)(k,{className:"w-4 h-4 mr-2"}),"Block User"]})]})]})})]},a.id))})]})}),(0,b.jsx)(C.Sheet,{open:Q,onOpenChange:R,children:(0,b.jsxs)(C.SheetContent,{className:"sm:max-w-lg overflow-y-auto",children:[(0,b.jsx)(C.SheetHeader,{children:(0,b.jsx)(C.SheetTitle,{children:"User Details"})}),M&&(0,b.jsxs)("div",{className:"space-y-6 py-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-2xl font-bold text-primary-foreground",children:M.name?.[0]?.toUpperCase()||"?"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xl font-bold",children:M.name||"Unnamed User"}),(0,b.jsxs)("p",{className:"text-muted-foreground",children:["+91 ",M.phone]}),ai(M)]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"glass-card p-4 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"XP Points"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-primary",children:M.xpPoints})]}),(0,b.jsxs)("div",{className:"glass-card p-4 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Level"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:M.level})]}),(0,b.jsxs)("div",{className:"glass-card p-4 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Streak"}),(0,b.jsxs)("p",{className:"text-2xl font-bold",children:[M.streakDays," days"]})]}),(0,b.jsxs)("div",{className:"glass-card p-4 rounded-xl",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Badges"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:M.badges.length})]})]}),(M.personaGoal||M.competitiveness||M.weeklyTimeCommitment||M.deliveryPreference)&&(0,b.jsxs)("div",{className:"space-y-4 pt-6 border-t border-border",children:[(0,b.jsxs)("p",{className:"text-sm font-bold flex items-center gap-2",children:[(0,b.jsx)(v.TrendingUp,{className:"w-4 h-4 text-primary"}),"Discovery Insights"]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[M.personaGoal&&(0,b.jsxs)("div",{className:"p-3 rounded-xl bg-muted/30 border border-white/5",children:[(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-widest mb-1",children:"Goal Vibe"}),(0,b.jsx)("p",{className:"text-xs font-bold capitalize",children:M.personaGoal.replace("_"," ")})]}),M.competitiveness&&(0,b.jsxs)("div",{className:"p-3 rounded-xl bg-muted/30 border border-white/5",children:[(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-widest mb-1",children:"Heat Level"}),(0,b.jsx)("p",{className:"text-xs font-bold capitalize",children:M.competitiveness.replace("_"," ")})]}),M.weeklyTimeCommitment&&(0,b.jsxs)("div",{className:"p-3 rounded-xl bg-muted/30 border border-white/5",children:[(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-widest mb-1",children:"Weekly Time"}),(0,b.jsx)("p",{className:"text-xs font-bold capitalize",children:M.weeklyTimeCommitment.replace(/_/g," ")})]}),M.deliveryPreference&&(0,b.jsxs)("div",{className:"p-3 rounded-xl bg-muted/30 border border-white/5",children:[(0,b.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-widest mb-1",children:"Preference"}),(0,b.jsx)("p",{className:"text-xs font-bold capitalize",children:M.deliveryPreference})]})]})]}),M.interests?.length>0&&(0,b.jsxs)("div",{className:"space-y-3 pt-6 border-t border-border",children:[(0,b.jsxs)("h4",{className:"font-semibold flex items-center gap-2",children:[(0,b.jsx)(u.Zap,{className:"w-4 h-4 text-primary"}),"Interests"]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:M.interests.map(a=>(0,b.jsx)(y.Badge,{variant:"secondary",className:"px-3 py-1 bg-muted/50 border-white/5",children:a},a))})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("h4",{className:"font-semibold flex items-center gap-2",children:[(0,b.jsx)(q.Calendar,{className:"w-4 h-4"}),"Registration Details"]}),(0,b.jsxs)("div",{className:"glass-card p-4 rounded-xl space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Registered"}),(0,b.jsx)("span",{children:M.createdAt.toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Created via"}),(0,b.jsx)("span",{className:"capitalize",children:M.createdVia})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Last Login"}),(0,b.jsx)("span",{children:M.lastLoginAt?.toLocaleString()||"Never"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Failed Attempts"}),(0,b.jsx)("span",{className:M.failedLoginAttempts>0?"text-destructive font-medium":"",children:M.failedLoginAttempts})]})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("h4",{className:"font-semibold flex items-center gap-2",children:[(0,b.jsx)(r,{className:"w-4 h-4"}),"Active Sessions (",O.filter(a=>a.isActive).length,")"]}),0===O.filter(a=>a.isActive).length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No active sessions"}):(0,b.jsx)("div",{className:"space-y-2",children:O.filter(a=>a.isActive).map(a=>(0,b.jsxs)("div",{className:"glass-card p-3 rounded-lg flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(r,{className:"w-5 h-5 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-sm font-medium",children:[a.browser," / ",a.device]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Last active: ",ah(a.lastActiveAt)]})]})]}),(0,b.jsx)("div",{className:"w-2 h-2 rounded-full bg-success animate-pulse"})]},a.id))})]}),M.isBlocked&&M.blockReason&&(0,b.jsxs)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-xl p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-destructive mb-2",children:[(0,b.jsx)(s,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"font-semibold",children:"Account Blocked"})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:M.blockReason})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(w.Button,{variant:"outline",className:"flex-1",onClick:()=>{V(!0)},children:[(0,b.jsx)(l.Key,{className:"w-4 h-4 mr-2"}),"Reset PIN"]}),(0,b.jsxs)(w.Button,{variant:"outline",className:"flex-1",onClick:()=>ag(M),children:[(0,b.jsx)(m.LogOut,{className:"w-4 h-4 mr-2"}),"End Sessions"]})]})]})]})}),(0,b.jsx)(B.Dialog,{open:S,onOpenChange:T,children:(0,b.jsxs)(B.DialogContent,{children:[(0,b.jsxs)(B.DialogHeader,{children:[(0,b.jsx)(B.DialogTitle,{children:"Block User"}),(0,b.jsx)(B.DialogDescription,{children:"This will prevent the user from logging in and terminate all active sessions."})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{children:"Reason for blocking"}),(0,b.jsx)(D.Textarea,{placeholder:"Enter the reason for blocking this user...",value:W,onChange:a=>X(a.target.value)})]})}),(0,b.jsxs)(B.DialogFooter,{children:[(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),(0,b.jsxs)(w.Button,{variant:"destructive",onClick:ad,disabled:$||!W.trim(),children:[$?(0,b.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):null,"Block User"]})]})]})}),(0,b.jsx)(B.Dialog,{open:U,onOpenChange:V,children:(0,b.jsxs)(B.DialogContent,{children:[(0,b.jsxs)(B.DialogHeader,{children:[(0,b.jsx)(B.DialogTitle,{children:"Reset PIN"}),(0,b.jsx)(B.DialogDescription,{children:"Set a new 4-digit PIN for this user. They will need to use this PIN to log in."})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(E.Label,{children:"New PIN (4 digits)"}),(0,b.jsx)(x.Input,{type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:4,placeholder:"0000",value:Y,onChange:a=>Z(a.target.value.replace(/\D/g,"").slice(0,4)),className:"text-center text-2xl tracking-widest font-mono"})]})}),(0,b.jsxs)(B.DialogFooter,{children:[(0,b.jsx)(w.Button,{variant:"outline",onClick:()=>{V(!1),Z("")},children:"Cancel"}),(0,b.jsxs)(w.Button,{onClick:af,disabled:$||4!==Y.length,children:[$?(0,b.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin mr-2"}):null,"Reset PIN"]})]})]})})]})}],11695)}];

//# sourceMappingURL=src_components_modules_admin_UsersManager_tsx_5e24be06._.js.map
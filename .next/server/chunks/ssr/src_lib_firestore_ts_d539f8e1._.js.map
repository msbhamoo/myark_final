{"version":3,"sources":["../../../../src/lib/firestore.ts"],"sourcesContent":["// Firestore service for admin operations\r\nimport {\r\n    collection,\r\n    doc,\r\n    getDocs,\r\n    getDoc,\r\n    addDoc,\r\n    updateDoc,\r\n    deleteDoc,\r\n    query,\r\n    where,\r\n    orderBy,\r\n    limit,\r\n    Timestamp,\r\n    onSnapshot,\r\n    increment,\r\n    type DocumentData,\r\n    type QueryConstraint,\r\n    arrayUnion,\r\n    arrayRemove,\r\n    documentId,\r\n} from \"firebase/firestore\";\r\nimport { db } from \"./firebase\";\r\nexport { db };\r\n\r\nimport type {\r\n    Opportunity,\r\n    BlogPost,\r\n    Career,\r\n    Student,\r\n    SchoolDemo,\r\n    Notification,\r\n    OpportunityTypeConfig,\r\n    Organizer,\r\n    Badge,\r\n    RedemptionReward,\r\n    RedemptionPartner\r\n} from \"@/types/admin\";\r\n\r\n// Collection names\r\nexport const COLLECTIONS = {\r\n    opportunities: \"opportunities\",\r\n    blogs: \"blogs\",\r\n    careers: \"careers\",\r\n    students: \"students\",\r\n    schoolDemos: \"schoolDemos\",\r\n    notifications: \"notifications\",\r\n    badges: \"badges\",\r\n    settings: \"settings\",\r\n    organizers: \"organizers\",\r\n} as const;\r\n\r\n// Helper to convert Firestore timestamp to Date\r\nexport const toDate = (timestamp: Timestamp | Date | undefined): Date | undefined => {\r\n    if (!timestamp) return undefined;\r\n    if (timestamp instanceof Timestamp) return timestamp.toDate();\r\n    return timestamp;\r\n};\r\n\r\n// Helper to convert Date to Firestore timestamp\r\nconst toTimestamp = (date: any): Timestamp | null => {\r\n    if (!date) return null;\r\n    if (date instanceof Timestamp) return date;\r\n    try {\r\n        const d = new Date(date);\r\n        return isNaN(d.getTime()) ? null : Timestamp.fromDate(d);\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n};\r\n\r\n// Sanitization helper to remove undefined values\r\nconst sanitizeData = (data: any) => {\r\n    const result: any = {};\r\n    Object.keys(data).forEach(key => {\r\n        if (data[key] !== undefined) {\r\n            result[key] = data[key];\r\n        }\r\n    });\r\n    return result;\r\n};\r\n\r\n// ============================================\r\n// OPPORTUNITIES\r\n// ============================================\r\n\r\nexport const opportunitiesService = {\r\n    async getAll(filters?: { type?: string; status?: string; limit?: number }) {\r\n        const constraints: QueryConstraint[] = [];\r\n\r\n        if (filters?.type && filters.type !== \"all\") {\r\n            constraints.push(where(\"type\", \"==\", filters.type));\r\n        }\r\n        if (filters?.status && filters.status !== \"all\") {\r\n            constraints.push(where(\"status\", \"==\", filters.status));\r\n        }\r\n        if (filters?.limit) {\r\n            constraints.push(limit(filters.limit));\r\n        }\r\n\r\n        const q = query(collection(db, COLLECTIONS.opportunities), ...constraints);\r\n        const snapshot = await getDocs(q);\r\n\r\n        return snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            dates: {\r\n                registrationStart: toDate(doc.data().dates?.registrationStart),\r\n                registrationEnd: toDate(doc.data().dates?.registrationEnd),\r\n                eventDate: toDate(doc.data().dates?.eventDate),\r\n            },\r\n            createdAt: toDate(doc.data().createdAt),\r\n            updatedAt: toDate(doc.data().updatedAt),\r\n        })) as Opportunity[];\r\n    },\r\n\r\n    async getById(id: string) {\r\n        const docRef = doc(db, COLLECTIONS.opportunities, id);\r\n        const snapshot = await getDoc(docRef);\r\n        if (!snapshot.exists()) return null;\r\n\r\n        return {\r\n            id: snapshot.id,\r\n            ...snapshot.data(),\r\n            dates: {\r\n                registrationStart: toDate(snapshot.data().dates?.registrationStart),\r\n                registrationEnd: toDate(snapshot.data().dates?.registrationEnd),\r\n                eventDate: toDate(snapshot.data().dates?.eventDate),\r\n            },\r\n            createdAt: toDate(snapshot.data().createdAt),\r\n            updatedAt: toDate(snapshot.data().updatedAt),\r\n        } as Opportunity;\r\n    },\r\n\r\n    async create(data: Omit<Opportunity, \"id\" | \"createdAt\" | \"updatedAt\">) {\r\n        const sanitizedData = sanitizeData(data);\r\n        const docRef = await addDoc(collection(db, COLLECTIONS.opportunities), {\r\n            ...sanitizedData,\r\n            dates: {\r\n                registrationStart: toTimestamp(data.dates.registrationStart),\r\n                registrationEnd: toTimestamp(data.dates.registrationEnd),\r\n                eventDate: toTimestamp(data.dates.eventDate),\r\n            },\r\n            hypeCount: 0,\r\n            applicationCount: 0,\r\n            createdAt: Timestamp.now(),\r\n            updatedAt: Timestamp.now(),\r\n        });\r\n        return docRef.id;\r\n    },\r\n\r\n    async update(id: string, data: Partial<Opportunity>) {\r\n        const docRef = doc(db, COLLECTIONS.opportunities, id);\r\n        const updateData: any = sanitizeData({\r\n            ...data,\r\n            updatedAt: Timestamp.now(),\r\n        });\r\n\r\n        if (data.dates) {\r\n            updateData.dates = {\r\n                registrationStart: toTimestamp(data.dates.registrationStart),\r\n                registrationEnd: toTimestamp(data.dates.registrationEnd),\r\n                eventDate: toTimestamp(data.dates.eventDate),\r\n            };\r\n        }\r\n\r\n        await updateDoc(docRef, updateData);\r\n    },\r\n\r\n    async hypeOpportunity(id: string) {\r\n        const docRef = doc(db, COLLECTIONS.opportunities, id);\r\n        await updateDoc(docRef, {\r\n            hypeCount: increment(1)\r\n        });\r\n    },\r\n\r\n    async delete(id: string) {\r\n        await deleteDoc(doc(db, COLLECTIONS.opportunities, id));\r\n    },\r\n\r\n    // Real-time listener\r\n    subscribe(callback: (opportunities: Opportunity[]) => void) {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.opportunities),\r\n            where(\"status\", \"==\", \"published\"),\r\n            orderBy(\"createdAt\", \"desc\")\r\n        );\r\n\r\n        return onSnapshot(q, (snapshot) => {\r\n            const opportunities = snapshot.docs.map(doc => ({\r\n                id: doc.id,\r\n                ...doc.data(),\r\n                dates: {\r\n                    registrationStart: toDate(doc.data().dates?.registrationStart),\r\n                    registrationEnd: toDate(doc.data().dates?.registrationEnd),\r\n                    eventDate: toDate(doc.data().dates?.eventDate),\r\n                },\r\n                createdAt: toDate(doc.data().createdAt),\r\n                updatedAt: toDate(doc.data().updatedAt),\r\n            })) as Opportunity[];\r\n            callback(opportunities);\r\n        });\r\n    },\r\n};\r\n\r\n// ============================================\r\n// BLOGS\r\n// ============================================\r\n\r\nexport const blogsService = {\r\n    async getAll(filters?: { status?: string; limit?: number }) {\r\n        const constraints: QueryConstraint[] = [];\r\n\r\n        if (filters?.status && filters.status !== \"all\") {\r\n            constraints.push(where(\"status\", \"==\", filters.status));\r\n        }\r\n        if (filters?.limit) {\r\n            constraints.push(limit(filters.limit));\r\n        }\r\n\r\n        const q = query(collection(db, COLLECTIONS.blogs), ...constraints);\r\n        const snapshot = await getDocs(q);\r\n\r\n        return snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            publishedAt: toDate(doc.data().publishedAt),\r\n            createdAt: toDate(doc.data().createdAt),\r\n            updatedAt: toDate(doc.data().updatedAt),\r\n        })) as BlogPost[];\r\n    },\r\n\r\n    async getById(id: string) {\r\n        const docRef = doc(db, COLLECTIONS.blogs, id);\r\n        const snapshot = await getDoc(docRef);\r\n        if (!snapshot.exists()) return null;\r\n\r\n        return {\r\n            id: snapshot.id,\r\n            ...snapshot.data(),\r\n            publishedAt: toDate(snapshot.data().publishedAt),\r\n            createdAt: toDate(snapshot.data().createdAt),\r\n            updatedAt: toDate(snapshot.data().updatedAt),\r\n        } as BlogPost;\r\n    },\r\n\r\n    async getBySlug(slug: string) {\r\n        const q = query(collection(db, COLLECTIONS.blogs), where(\"slug\", \"==\", slug), limit(1));\r\n        const snapshot = await getDocs(q);\r\n        if (snapshot.empty) return null;\r\n\r\n        const doc = snapshot.docs[0];\r\n        return {\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            publishedAt: toDate(doc.data().publishedAt),\r\n            createdAt: toDate(doc.data().createdAt),\r\n            updatedAt: toDate(doc.data().updatedAt),\r\n        } as BlogPost;\r\n    },\r\n\r\n    async create(data: Omit<BlogPost, \"id\" | \"createdAt\" | \"updatedAt\">) {\r\n        const docRef = await addDoc(collection(db, COLLECTIONS.blogs), {\r\n            ...data,\r\n            viewCount: 0,\r\n            publishedAt: data.status === \"published\" ? Timestamp.now() : null,\r\n            createdAt: Timestamp.now(),\r\n            updatedAt: Timestamp.now(),\r\n        });\r\n        return docRef.id;\r\n    },\r\n\r\n    async update(id: string, data: Partial<BlogPost>) {\r\n        const docRef = doc(db, COLLECTIONS.blogs, id);\r\n        await updateDoc(docRef, sanitizeData({\r\n            ...data,\r\n            updatedAt: Timestamp.now(),\r\n        }));\r\n    },\r\n\r\n    async delete(id: string) {\r\n        await deleteDoc(doc(db, COLLECTIONS.blogs, id));\r\n    },\r\n};\r\n\r\n// ============================================\r\n// CAREERS\r\n// ============================================\r\n\r\nexport const careersService = {\r\n    async getAll(filters?: { status?: string; limit?: number }) {\r\n        const constraints: QueryConstraint[] = [orderBy(\"createdAt\", \"desc\")];\r\n\r\n        if (filters?.status && filters.status !== \"all\") {\r\n            constraints.push(where(\"status\", \"==\", filters.status));\r\n        }\r\n        if (filters?.limit) {\r\n            constraints.push(limit(filters.limit));\r\n        }\r\n\r\n        const q = query(collection(db, COLLECTIONS.careers), ...constraints);\r\n        const snapshot = await getDocs(q);\r\n\r\n        return snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            postedAt: toDate(doc.data().postedAt),\r\n            expiresAt: toDate(doc.data().expiresAt),\r\n            createdAt: toDate(doc.data().createdAt),\r\n            updatedAt: toDate(doc.data().updatedAt),\r\n        })) as unknown as Career[];\r\n    },\r\n\r\n    async getById(id: string) {\r\n        const docRef = doc(db, COLLECTIONS.careers, id);\r\n        const snapshot = await getDoc(docRef);\r\n        if (!snapshot.exists()) return null;\r\n\r\n        return {\r\n            id: snapshot.id,\r\n            ...snapshot.data(),\r\n            postedAt: toDate(snapshot.data().postedAt),\r\n            expiresAt: toDate(snapshot.data().expiresAt),\r\n            createdAt: toDate(snapshot.data().createdAt),\r\n            updatedAt: toDate(snapshot.data().updatedAt),\r\n        } as unknown as Career;\r\n    },\r\n\r\n    async getBySlug(slug: string) {\r\n        const q = query(collection(db, COLLECTIONS.careers), where(\"slug\", \"==\", slug), limit(1));\r\n        const snapshot = await getDocs(q);\r\n        if (snapshot.empty) return null;\r\n\r\n        const doc = snapshot.docs[0];\r\n        return {\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            postedAt: toDate(doc.data().postedAt),\r\n            expiresAt: toDate(doc.data().expiresAt),\r\n            createdAt: toDate(doc.data().createdAt),\r\n            updatedAt: toDate(doc.data().updatedAt),\r\n        } as unknown as Career;\r\n    },\r\n\r\n    async create(data: Omit<Career, \"id\" | \"createdAt\" | \"updatedAt\">) {\r\n        const docRef = await addDoc(collection(db, COLLECTIONS.careers), {\r\n            ...data,\r\n            applicationCount: 0,\r\n            postedAt: Timestamp.now(),\r\n            createdAt: Timestamp.now(),\r\n            updatedAt: Timestamp.now(),\r\n        });\r\n        return docRef.id;\r\n    },\r\n\r\n    async update(id: string, data: Partial<Career>) {\r\n        const docRef = doc(db, COLLECTIONS.careers, id);\r\n        await updateDoc(docRef, sanitizeData({\r\n            ...data,\r\n            updatedAt: Timestamp.now(),\r\n        }));\r\n    },\r\n\r\n    async delete(id: string) {\r\n        await deleteDoc(doc(db, COLLECTIONS.careers, id));\r\n    },\r\n};\r\n\r\n// ============================================\r\n// STUDENTS\r\n// ============================================\r\n\r\nexport const studentsService = {\r\n    async getAll(filters?: { grade?: number; limit?: number }) {\r\n        const constraints: QueryConstraint[] = [orderBy(\"createdAt\", \"desc\")];\r\n\r\n        if (filters?.grade) {\r\n            constraints.push(where(\"grade\", \"==\", filters.grade));\r\n        }\r\n        if (filters?.limit) {\r\n            constraints.push(limit(filters.limit));\r\n        }\r\n\r\n        const q = query(collection(db, COLLECTIONS.students), ...constraints);\r\n        const snapshot = await getDocs(q);\r\n\r\n        return snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            createdAt: toDate(doc.data().createdAt),\r\n            lastActiveAt: toDate(doc.data().lastActiveAt),\r\n        })) as Student[];\r\n    },\r\n\r\n    async getById(id: string) {\r\n        const docRef = doc(db, COLLECTIONS.students, id);\r\n        const snapshot = await getDoc(docRef);\r\n        if (!snapshot.exists()) return null;\r\n\r\n        return {\r\n            id: snapshot.id,\r\n            ...snapshot.data(),\r\n            createdAt: toDate(snapshot.data().createdAt),\r\n            lastActiveAt: toDate(snapshot.data().lastActiveAt),\r\n        } as Student;\r\n    },\r\n\r\n    async getStats() {\r\n        const snapshot = await getDocs(collection(db, COLLECTIONS.students));\r\n        const students = snapshot.docs.map(doc => doc.data());\r\n\r\n        const now = new Date();\r\n        const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n\r\n        return {\r\n            total: students.length,\r\n            activeThisWeek: students.filter(s => {\r\n                const lastActive = toDate(s.lastActiveAt);\r\n                return lastActive && lastActive >= sevenDaysAgo;\r\n            }).length,\r\n            avgStreak: students.length > 0\r\n                ? Math.round(students.reduce((sum, s) => sum + (s.streakDays || 0), 0) / students.length)\r\n                : 0,\r\n        };\r\n    },\r\n\r\n    async assignBadge(studentId: string, badgeId: string) {\r\n        const docRef = doc(db, COLLECTIONS.students, studentId);\r\n        await updateDoc(docRef, {\r\n            badges: arrayUnion(badgeId),\r\n            updatedAt: Timestamp.now(),\r\n        });\r\n    },\r\n\r\n    async removeBadge(studentId: string, badgeId: string) {\r\n        const docRef = doc(db, COLLECTIONS.students, studentId);\r\n        await updateDoc(docRef, {\r\n            badges: arrayRemove(badgeId),\r\n            updatedAt: Timestamp.now(),\r\n        });\r\n    },\r\n};\r\n\r\n// ============================================\r\n// SCHOOL DEMOS\r\n// ============================================\r\n\r\nexport const schoolDemosService = {\r\n    async getAll(filters?: { status?: string }) {\r\n        const constraints: QueryConstraint[] = [orderBy(\"createdAt\", \"desc\")];\r\n\r\n        if (filters?.status && filters.status !== \"all\") {\r\n            constraints.push(where(\"status\", \"==\", filters.status));\r\n        }\r\n\r\n        const q = query(collection(db, COLLECTIONS.schoolDemos), ...constraints);\r\n        const snapshot = await getDocs(q);\r\n\r\n        return snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            scheduledDate: toDate(doc.data().scheduledDate),\r\n            createdAt: toDate(doc.data().createdAt),\r\n            updatedAt: toDate(doc.data().updatedAt),\r\n        })) as SchoolDemo[];\r\n    },\r\n\r\n    async updateStatus(id: string, status: string, notes?: string) {\r\n        const docRef = doc(db, COLLECTIONS.schoolDemos, id);\r\n        await updateDoc(docRef, {\r\n            status,\r\n            notes: notes || null,\r\n            updatedAt: Timestamp.now(),\r\n        });\r\n    },\r\n\r\n    async getCountByStatus() {\r\n        const snapshot = await getDocs(collection(db, COLLECTIONS.schoolDemos));\r\n        const counts: Record<string, number> = {\r\n            pending: 0,\r\n            contacted: 0,\r\n            scheduled: 0,\r\n            completed: 0,\r\n            rejected: 0,\r\n        };\r\n\r\n        snapshot.docs.forEach(doc => {\r\n            const status = doc.data().status;\r\n            if (counts[status] !== undefined) {\r\n                counts[status]++;\r\n            }\r\n        });\r\n\r\n        return counts;\r\n    },\r\n};\r\n\r\n// ============================================\r\n// NOTIFICATIONS\r\n// ============================================\r\n\r\nexport const notificationsService = {\r\n    async getAll() {\r\n        const q = query(\r\n            collection(db, COLLECTIONS.notifications),\r\n            orderBy(\"createdAt\", \"desc\")\r\n        );\r\n        const snapshot = await getDocs(q);\r\n\r\n        return snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            scheduledFor: toDate(doc.data().scheduledFor),\r\n            sentAt: toDate(doc.data().sentAt),\r\n            createdAt: toDate(doc.data().createdAt),\r\n        })) as Notification[];\r\n    },\r\n\r\n    async send(data: Omit<Notification, \"id\" | \"createdAt\" | \"sentAt\">) {\r\n        const docRef = await addDoc(collection(db, COLLECTIONS.notifications), sanitizeData({\r\n            ...data,\r\n            sentAt: Timestamp.now(),\r\n            createdAt: Timestamp.now(),\r\n        }));\r\n        return docRef.id;\r\n    },\r\n};\r\n\r\n// ============================================\r\n// SETTINGS\r\n// ============================================\r\n\r\nexport const settingsService = {\r\n    async getOpportunityTypes(): Promise<OpportunityTypeConfig[]> {\r\n        const docRef = doc(db, COLLECTIONS.settings, \"opportunityTypes\");\r\n        const snapshot = await getDoc(docRef);\r\n\r\n        if (!snapshot.exists()) {\r\n            // Return defaults if not set\r\n            return [];\r\n        }\r\n\r\n        return snapshot.data().types || [];\r\n    },\r\n\r\n    async saveOpportunityTypes(types: OpportunityTypeConfig[]) {\r\n        const docRef = doc(db, COLLECTIONS.settings, \"opportunityTypes\");\r\n        await updateDoc(docRef, { types });\r\n    },\r\n\r\n    async getGrades(): Promise<number[]> {\r\n        const docRef = doc(db, COLLECTIONS.settings, \"grades\");\r\n        const snapshot = await getDoc(docRef);\r\n\r\n        if (!snapshot.exists()) {\r\n            return [6, 7, 8, 9, 10, 11, 12]; // defaults\r\n        }\r\n\r\n        return snapshot.data().grades || [];\r\n    },\r\n\r\n    async saveGrades(grades: number[]) {\r\n        const docRef = doc(db, COLLECTIONS.settings, \"grades\");\r\n        await updateDoc(docRef, { grades });\r\n    },\r\n\r\n    async getTags(): Promise<string[]> {\r\n        const docRef = doc(db, COLLECTIONS.settings, \"tags\");\r\n        const snapshot = await getDoc(docRef);\r\n\r\n        if (!snapshot.exists()) {\r\n            return [];\r\n        }\r\n\r\n        return snapshot.data().tags || [];\r\n    },\r\n\r\n    async saveTags(tags: string[]) {\r\n        const docRef = doc(db, COLLECTIONS.settings, \"tags\");\r\n        await updateDoc(docRef, { tags });\r\n    },\r\n\r\n    async getOrganizers(): Promise<Organizer[]> {\r\n        const querySnapshot = await getDocs(collection(db, COLLECTIONS.organizers));\r\n        return querySnapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            createdAt: toDate(doc.data().createdAt),\r\n            updatedAt: toDate(doc.data().updatedAt),\r\n        })) as Organizer[];\r\n    },\r\n\r\n    async saveOrganizer(data: Omit<Organizer, \"id\" | \"createdAt\" | \"updatedAt\">) {\r\n        const docRef = await addDoc(collection(db, COLLECTIONS.organizers), sanitizeData({\r\n            ...data,\r\n            createdAt: Timestamp.now(),\r\n            updatedAt: Timestamp.now(),\r\n        }));\r\n        return docRef.id;\r\n    },\r\n\r\n    async deleteOrganizer(id: string) {\r\n        await deleteDoc(doc(db, COLLECTIONS.organizers, id));\r\n    },\r\n};\r\n\r\n// ============================================\r\n// DASHBOARD STATS\r\n// ============================================\r\n\r\nexport const dashboardService = {\r\n    async getStats() {\r\n        const [opportunities, students, demos] = await Promise.all([\r\n            getDocs(collection(db, COLLECTIONS.opportunities)),\r\n            studentsService.getStats(),\r\n            schoolDemosService.getCountByStatus(),\r\n        ]);\r\n\r\n        const publishedOpportunities = opportunities.docs.filter(\r\n            doc => doc.data().status === \"published\"\r\n        ).length;\r\n\r\n        return {\r\n            totalOpportunities: opportunities.size,\r\n            publishedOpportunities,\r\n            totalStudents: students.total,\r\n            activeStudents: students.activeThisWeek,\r\n            pendingDemos: demos.pending,\r\n        };\r\n    },\r\n};\r\n\r\n// ============================================\r\n// BADGES\r\n// ============================================\r\n\r\nexport const badgesService = {\r\n    async getAll(): Promise<Badge[]> {\r\n        const q = query(collection(db, COLLECTIONS.badges), orderBy(\"createdAt\", \"desc\"));\r\n        const querySnapshot = await getDocs(q);\r\n        return querySnapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            createdAt: toDate(doc.data().createdAt),\r\n            updatedAt: toDate(doc.data().updatedAt),\r\n        })) as Badge[];\r\n    },\r\n\r\n    async getById(id: string): Promise<Badge | null> {\r\n        const docRef = doc(db, COLLECTIONS.badges, id);\r\n        const snapshot = await getDoc(docRef);\r\n        if (!snapshot.exists()) return null;\r\n        return {\r\n            id: snapshot.id,\r\n            ...snapshot.data(),\r\n            createdAt: toDate(snapshot.data().createdAt),\r\n            updatedAt: toDate(snapshot.data().updatedAt),\r\n        } as Badge;\r\n    },\r\n\r\n    async create(data: Omit<Badge, \"id\" | \"createdAt\" | \"updatedAt\">) {\r\n        const sanitizedData = sanitizeData(data);\r\n        const docRef = await addDoc(collection(db, COLLECTIONS.badges), {\r\n            ...sanitizedData,\r\n            createdAt: Timestamp.now(),\r\n            updatedAt: Timestamp.now(),\r\n        });\r\n        return docRef.id;\r\n    },\r\n\r\n    async update(id: string, data: Partial<Badge>) {\r\n        const docRef = doc(db, COLLECTIONS.badges, id);\r\n        await updateDoc(docRef, {\r\n            ...sanitizeData(data),\r\n            updatedAt: Timestamp.now(),\r\n        });\r\n    },\r\n\r\n    async delete(id: string) {\r\n        await deleteDoc(doc(db, COLLECTIONS.badges, id));\r\n    },\r\n};\r\n// ============================================\r\n// REDEMPTION\r\n// ============================================\r\n\r\nexport const rewardsService = {\r\n    async getAll() {\r\n        // Fetch all active rewards\r\n        // REMOVED orderBy to avoid \"Missing Index\" error. Sorting client-side instead.\r\n        const q = query(collection(db, \"rewards\"), where(\"isActive\", \"==\", true));\r\n        const snapshot = await getDocs(q);\r\n\r\n        const rewards = snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            expiresAt: toDate(doc.data().expiresAt),\r\n            createdAt: toDate(doc.data().createdAt),\r\n        })) as RedemptionReward[];\r\n\r\n        return rewards.sort((a, b) => a.xpCost - b.xpCost);\r\n    },\r\n\r\n    async getPartners() {\r\n        const snapshot = await getDocs(collection(db, \"partners\"));\r\n        return snapshot.docs.map(doc => ({\r\n            id: doc.id,\r\n            ...doc.data(),\r\n            createdAt: toDate(doc.data().createdAt),\r\n        })) as RedemptionPartner[];\r\n    },\r\n\r\n    async redeem(rewardId: string, studentId: string, xpCost: number) {\r\n        // 1. Deduct XP (handled by cloud function usually, but client-side for demo)\r\n        // 2. Add claim record\r\n        // This logic is ideally transactional\r\n\r\n        // Simulating claim:\r\n        const claimRef = await addDoc(collection(db, \"claims\"), {\r\n            rewardId,\r\n            studentId,\r\n            xpCost,\r\n            claimedAt: Timestamp.now(),\r\n            status: \"active\"\r\n        });\r\n\r\n        // Increment claim count on reward\r\n        const rewardRef = doc(db, \"rewards\", rewardId);\r\n        await updateDoc(rewardRef, {\r\n            claimCount: increment(1)\r\n        });\r\n\r\n        return claimRef.id;\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}
module.exports=[68436,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(69387);var d=a.i(60574),e=a.i(20237);let f="studentUsers",g="studentSessions";async function h(a){let b=new TextEncoder().encode(a+"myark_salt_2026");return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",b))).map(a=>a.toString(16).padStart(2,"0")).join("")}async function i(a,b){return await h(a)===b}let j={async register(a,b){try{let c=a.replace(/\D/g,"");if(10!==c.length)return{success:!1,error:"Please enter a valid 10-digit mobile number",errorCode:"INVALID_PHONE"};if(!/^\d{4}$/.test(b))return{success:!1,error:"PIN must be 4 digits",errorCode:"INVALID_PIN"};let g=(0,d.query)((0,d.collection)(e.db,f),(0,d.where)("phone","==",c));if(!(await (0,d.getDocs)(g)).empty)return{success:!1,error:"This number is already registered. Try logging in!",errorCode:"PHONE_EXISTS"};let i=await h(b),j=`user_${c}_${Date.now()}`,k=new Date,l={id:j,phone:c,xpPoints:50,level:1,streakDays:1,badges:["early_bird"],interests:[],appliedOpportunities:[],savedOpportunities:[],isVerified:!0,isBlocked:!1,failedLoginAttempts:0,lastLoginAt:k,createdAt:k,createdVia:"web"};await (0,d.setDoc)((0,d.doc)(e.db,f,j),{...l,pinHash:i,createdAt:d.Timestamp.fromDate(k),lastLoginAt:d.Timestamp.fromDate(k)});let m=await this.createSession(j);return{success:!0,user:l,session:m}}catch(a){return console.error("Registration error:",a),{success:!1,error:"Something went wrong. Please try again!"}}},async login(a,b){try{let c=a.replace(/\D/g,"");if(10!==c.length)return{success:!1,error:"Please enter a valid 10-digit mobile number",errorCode:"INVALID_PHONE"};let g=(0,d.query)((0,d.collection)(e.db,f),(0,d.where)("phone","==",c)),h=await (0,d.getDocs)(g);if(h.empty)return{success:!1,error:"No account found with this number. Want to register?",errorCode:"USER_NOT_FOUND"};let j=h.docs[0],k=j.data();if(k.isBlocked)return{success:!1,error:"Your account has been blocked. Contact support for help.",errorCode:"BLOCKED"};let l=await this.checkRateLimit(k);if(!l.allowed){let a=Math.ceil((l.lockoutUntil.getTime()-Date.now())/6e4);return{success:!1,error:`Too many attempts! Take a break for ${a} min â˜•`,errorCode:"RATE_LIMITED"}}if(!await i(b,k.pinHash)){await this.incrementFailedAttempts(j.id);let a=5-(k.failedLoginAttempts+1);return{success:!1,error:a>0?`Wrong PIN! ${a} attempts left ðŸŽ¯`:"Wrong PIN! Account locked for 5 minutes.",errorCode:"WRONG_PIN"}}let m=function(a,b){if(!a)return 1;let c=new Date,d=new Date(a);d.setHours(0,0,0,0);let e=new Date(c);e.setHours(0,0,0,0);let f=Math.round((e.getTime()-d.getTime())/864e5);return 1===f?b+1:f>1?1:b||1}(k.lastLoginAt?.toDate(),k.streakDays||0);await (0,d.updateDoc)((0,d.doc)(e.db,f,j.id),{failedLoginAttempts:0,lastLoginAt:d.Timestamp.now(),streakDays:m,xpPoints:(0,d.increment)(10)});let n=await this.createSession(j.id),o={id:j.id,phone:k.phone,name:k.name,grade:k.grade,school:k.school,city:k.city,state:k.state,profilePicture:k.profilePicture,gender:k.gender,interests:k.interests||[],appliedOpportunities:k.appliedOpportunities||[],savedOpportunities:k.savedOpportunities||[],xpPoints:(k.xpPoints||0)+10,level:k.level||1,streakDays:m,badges:k.badges||[],isVerified:k.isVerified||!0,isBlocked:!1,failedLoginAttempts:0,lastLoginAt:new Date,createdAt:k.createdAt?.toDate()||new Date,createdVia:k.createdVia||"web"};return{success:!0,user:o,session:n}}catch(a){return console.error("Login error:",a),{success:!1,error:"Something went wrong. Please try again!"}}},async createSession(a){let b,c,f,{device:h,browser:i}=(b=navigator.userAgent,c="Unknown Device",f="Unknown Browser",/iPhone/i.test(b)?c="iPhone":/iPad/i.test(b)?c="iPad":/Android/i.test(b)?c="Android":/Windows/i.test(b)?c="Windows":/Mac/i.test(b)?c="Mac":/Linux/i.test(b)&&(c="Linux"),/Chrome/i.test(b)&&!/Edg/i.test(b)?f="Chrome":/Safari/i.test(b)&&!/Chrome/i.test(b)?f="Safari":/Firefox/i.test(b)?f="Firefox":/Edg/i.test(b)&&(f="Edge"),{device:c,browser:f}),j=`session_${a}_${Date.now()}`,k=new Date,l={id:j,userId:a,device:h,browser:i,createdAt:k,lastActiveAt:k,isActive:!0};return await (0,d.setDoc)((0,d.doc)(e.db,g,j),{...l,createdAt:d.Timestamp.fromDate(k),lastActiveAt:d.Timestamp.fromDate(k)}),localStorage.setItem("myark_session",j),localStorage.setItem("myark_user_id",a),l},async validateSession(a){try{let b=await (0,d.getDoc)((0,d.doc)(e.db,g,a));if(!b.exists())return null;let c=b.data();if(!c.isActive)return null;let h=c.createdAt?.toDate()||new Date,i=new Date(h.getTime()+2592e6);if(new Date>i)return await this.terminateSession(a),null;let j=await (0,d.getDoc)((0,d.doc)(e.db,f,c.userId));if(!j.exists())return null;let k=j.data();if(k.isBlocked)return null;return await (0,d.updateDoc)((0,d.doc)(e.db,g,a),{lastActiveAt:d.Timestamp.now()}),{id:j.id,phone:k.phone,name:k.name,grade:k.grade,school:k.school,city:k.city,state:k.state,profilePicture:k.profilePicture,gender:k.gender,interests:k.interests||[],appliedOpportunities:k.appliedOpportunities||[],savedOpportunities:k.savedOpportunities||[],xpPoints:k.xpPoints||0,level:k.level||1,streakDays:k.streakDays||0,badges:k.badges||[],isVerified:k.isVerified||!0,isBlocked:!1,failedLoginAttempts:0,lastLoginAt:k.lastLoginAt?.toDate(),createdAt:k.createdAt?.toDate()||new Date,createdVia:k.createdVia||"web"}}catch(a){return console.error("Session validation error:",a),null}},async terminateSession(a){try{await (0,d.updateDoc)((0,d.doc)(e.db,g,a),{isActive:!1})}catch(a){console.error("Session termination error:",a)}},async logout(){let a=localStorage.getItem("myark_session");a&&await this.terminateSession(a),localStorage.removeItem("myark_session"),localStorage.removeItem("myark_user_id")},async checkRateLimit(a){let b=a.failedLoginAttempts||0,c=a.lastFailedAttempt?.toDate();if(b>=5&&c){let a=new Date(c.getTime()+3e5);if(new Date<a)return{allowed:!1,remainingAttempts:0,lockoutUntil:a}}return{allowed:!0,remainingAttempts:5-b}},async incrementFailedAttempts(a){await (0,d.updateDoc)((0,d.doc)(e.db,f,a),{failedLoginAttempts:(0,d.increment)(1),lastFailedAttempt:d.Timestamp.now()})},async getAllUsers(a){try{let b=(0,d.collection)(e.db,f),c=(await (0,d.getDocs)(b)).docs.map(a=>{let b=a.data();return{id:a.id,phone:b.phone,name:b.name,grade:b.grade,school:b.school,city:b.city,xpPoints:b.xpPoints||0,level:b.level||1,streakDays:b.streakDays||0,badges:b.badges||[],isVerified:b.isVerified||!0,isBlocked:b.isBlocked||!1,blockReason:b.blockReason,failedLoginAttempts:b.failedLoginAttempts||0,lastLoginAt:b.lastLoginAt?.toDate(),lastFailedAttempt:b.lastFailedAttempt?.toDate(),createdAt:b.createdAt?.toDate()||new Date,createdVia:b.createdVia||"web",personaGoal:b.personaGoal,competitiveness:b.competitiveness,weeklyTimeCommitment:b.weeklyTimeCommitment,deliveryPreference:b.deliveryPreference,interests:b.interests||[]}});if(a?.search){let b=a.search.toLowerCase();c=c.filter(a=>a.phone.includes(b)||a.name?.toLowerCase().includes(b))}return a?.blocked!==void 0&&(c=c.filter(b=>b.isBlocked===a.blocked)),c.sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime())}catch(a){return console.error("Error fetching users:",a),[]}},async getUserSessions(a){try{let b=(0,d.query)((0,d.collection)(e.db,g),(0,d.where)("userId","==",a));return(await (0,d.getDocs)(b)).docs.map(a=>{let b=a.data();return{id:a.id,userId:b.userId,device:b.device,browser:b.browser,createdAt:b.createdAt?.toDate()||new Date,lastActiveAt:b.lastActiveAt?.toDate()||new Date,isActive:b.isActive}}).sort((a,b)=>b.lastActiveAt.getTime()-a.lastActiveAt.getTime())}catch(a){return console.error("Error fetching sessions:",a),[]}},async blockUser(a,b){for(let c of(await (0,d.updateDoc)((0,d.doc)(e.db,f,a),{isBlocked:!0,blockReason:b}),await this.getUserSessions(a)))await this.terminateSession(c.id)},async unblockUser(a){await (0,d.updateDoc)((0,d.doc)(e.db,f,a),{isBlocked:!1,blockReason:null,failedLoginAttempts:0})},async resetUserPin(a,b){let c=await h(b);await (0,d.updateDoc)((0,d.doc)(e.db,f,a),{pinHash:c,failedLoginAttempts:0})},async terminateAllUserSessions(a){for(let b of(await this.getUserSessions(a)))await this.terminateSession(b.id)},async updateUserXP(a,b){await (0,d.updateDoc)((0,d.doc)(e.db,f,a),{xpPoints:(0,d.increment)(b)})},async updateProfile(a,b){let c=["name","profilePicture","grade","school","city","state","gender","interests","personaGoal","competitiveness","weeklyTimeCommitment","deliveryPreference","badges"],g={};for(let[a,d]of Object.entries(b))c.includes(a)&&void 0!==d&&(g[a]=d);Object.keys(g).length>0&&await (0,d.updateDoc)((0,d.doc)(e.db,f,a),g)},async saveOpportunity(b,c){let{arrayUnion:g}=await a.A(28162);await (0,d.updateDoc)((0,d.doc)(e.db,f,b),{savedOpportunities:g(c),xpPoints:(0,d.increment)(5)})},async unsaveOpportunity(b,c){let{arrayRemove:g}=await a.A(28162);await (0,d.updateDoc)((0,d.doc)(e.db,f,b),{savedOpportunities:g(c)})},async applyToOpportunity(b,c){let{arrayUnion:g}=await a.A(28162);await (0,d.updateDoc)((0,d.doc)(e.db,f,b),{appliedOpportunities:g(c),xpPoints:(0,d.increment)(40)})},async addProfileXP(a,b){await (0,d.updateDoc)((0,d.doc)(e.db,f,a),{xpPoints:(0,d.increment)(b)})}},k=(0,c.createContext)(void 0);a.s(["StudentAuthProvider",0,({children:a})=>{let[d,e]=(0,c.useState)(null),[f,g]=(0,c.useState)(!0),[h,i]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null);(0,c.useEffect)(()=>{(async()=>{try{let a=localStorage.getItem("myark_session");if(a){let b=await j.validateSession(a);b?e(b):(localStorage.removeItem("myark_session"),localStorage.removeItem("myark_user_id"))}}catch(a){console.error("Session check error:",a)}finally{g(!1)}})()},[]);let n=(0,c.useCallback)(a=>{m(a||{mode:"login"}),i(!0)},[]),o=(0,c.useCallback)(()=>{i(!1),l?.onClose?.(),setTimeout(()=>m(null),300)},[l]),p=(0,c.useCallback)(async(a,b)=>{let c=await j.login(a,b);return c.success&&c.user&&(e(c.user),o(),l?.onSuccess?.()),c},[o,l]),q=(0,c.useCallback)(async(a,b)=>{let c=await j.register(a,b);return c.success&&c.user&&(e(c.user),o(),l?.onSuccess?.()),c},[o,l]),r=(0,c.useCallback)(async()=>{await j.logout(),e(null)},[]),s=(0,c.useCallback)(async()=>{let a=localStorage.getItem("myark_session");if(a){let b=await j.validateSession(a);b&&e(b)}},[]),t=(0,c.useCallback)(a=>{d&&e(b=>b?{...b,xpPoints:b.xpPoints+a}:null)},[d]),u=(0,c.useCallback)(async a=>{if(d){e(b=>b?{...b,...a}:null);try{await j.updateProfile(d.id,a)}catch(a){throw console.error("Failed to update profile:",a),await s(),a}}},[d,s]),v=(0,c.useCallback)(async a=>{if(d){e(b=>b?{...b,savedOpportunities:[...b.savedOpportunities||[],a],xpPoints:b.xpPoints+5}:null);try{await j.saveOpportunity(d.id,a)}catch(a){console.error("Failed to save opportunity:",a),await s()}}},[d,s]),w=(0,c.useCallback)(async a=>{if(d){e(b=>b?{...b,savedOpportunities:(b.savedOpportunities||[]).filter(b=>b!==a)}:null);try{await j.unsaveOpportunity(d.id,a)}catch(a){console.error("Failed to unsave opportunity:",a),await s()}}},[d,s]),x=(0,c.useCallback)(async a=>{if(d){e(b=>b?{...b,appliedOpportunities:[...b.appliedOpportunities||[],a],xpPoints:b.xpPoints+40}:null);try{await j.applyToOpportunity(d.id,a)}catch(a){console.error("Failed to apply to opportunity:",a),await s()}}},[d,s]),y=(0,c.useCallback)(async a=>{if(d){e(b=>b?{...b,xpPoints:b.xpPoints+a}:null);try{await j.addProfileXP(d.id,a)}catch(a){console.error("Failed to add XP:",a),await s()}}},[d,s]);return(0,b.jsx)(k.Provider,{value:{student:d,loading:f,isAuthenticated:!!d,authModalOpen:h,authModalOptions:l,showAuthModal:n,hideAuthModal:o,login:p,register:q,logout:r,refreshUser:s,addXP:t,updateStudent:u,saveOpportunity:v,unsaveOpportunity:w,applyToOpportunity:x,addXPWithPersist:y},children:a})},"useStudentAuth",0,()=>{let a=(0,c.useContext)(k);if(!a)throw Error("useStudentAuth must be used within a StudentAuthProvider");return a}],68436)},63519,a=>{"use strict";let b=(0,a.i(70106).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);a.s(["Phone",()=>b],63519)}];

//# sourceMappingURL=_4e98502c._.js.map